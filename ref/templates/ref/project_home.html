{% extends "base.html" %}
{% load get_item folder_crumbs from filter %}
{% load cache %}

{% block pagetitle %}Accueil{% endblock %}

{%block navigationButtons%}
    <a href='{% url "admin:index" %}' title="Administration">A</a>
{% endblock %}

{% cache 60 project_home_cache folder_id %}

{% block maintitle %}{{ folder | folder_crumbs }}{% endblock %}

{%block frequentActionsButtons%}
    <a href='{% url "ref:set_acl" folder_id=folder_id %}' title="Editer les habilitations">P</a>
    {%  if folder.empty %}<a href='{% url "ref:folder_delete" folder_id=folder_id %}' title="Supprimer ce dossier">S</a>{%  endif %}
{%  endblock %}

{% block content %}
<div style='color: white;' class='row'>

{%  if folder.subfolders.count > 0 %}
<div class='col-sm-2'>
    <div style='color: white;' class='row'>
		<div class='t2' style='color: black;'>Sous dossiers</div>
	</div>
    <div style='color: white;' class='row'>
        {%  for folder in folder.subfolders.all %}
            <a class='metSquare homeCoulour2' href="{% url 'ref:project_home' folder.id %}">{{folder.name}}<div class='metSquareLong annotation'>{{folder.description}}</div></a>
        {% endfor %}
    </div>
</div>
{%  endif %}

<div class='col-sm-{%  if folder.subfolders.count > 0 %}3{%  else %}5{% endif %}'>
	<div style='color: white;' class='row'>
		<div class='t2' style='color: black;'>Les environnements</div>
	</div>
	<div style='color: white;' class='row'>	
		<a class='metSquare homeCoulour1' href="{% url 'ref:cartoform' folder_id %}">Carte interactive</a>
		<a class='metSquare homeCoulour1' href="{% url 'ref:grscope' folder_id %}">Carte complète du contenu du dossier</a>
		<a class='metSquare homeCoulour1' href="{% url 'ref:new_item' %}">Créer un élément de référentiel</a>
        <a class='metSquare homeCoulour1' href="{% url 'ref:backuped' folder_id %}">Eléments sauvegardés{% if folder.subfolders.count > 0  %} (dont sous dossiers){% endif %}</a>
        <a class='metSquare homeCoulour1' href="{% url 'ref:shared_ci' folder_id %}">Composants mutualisés de ce dossier</a>
        {% if folder.subfolders.count > 0  %}
        <a class='metSquare homeCoulour1' href="{% url 'ref:shared_ci_rec' folder_id %}">Composants mutualisés de ce dossier et sous dossiers</a>
        {%  endif %}
		<div>
		{% for envt in envts %}
		<a class='metSquare' href="{% url 'ref:envt' envt.id %}">{{envt.name}}<div class='metSquareLong annotation'>{{envt.description}}</div></a>	
		{%endfor %}
		</div>
	</div>
</div>

<div class='col-sm-3'>
	<div style='color: white;' class='row'>
		<div class='t2' style='color: black;'>Gestion de configuration</div>
	</div>
	<div style='color: white;' class='row'>	
		<a class='metSquare homeCoulour2' href="{% url 'scm:lc_installs_envts' %}">Synthèse des versions courantes</a>
		<a class='metSquare homeCoulour2' href="{% url 'scm:deliveries' %}">Livraisons disponibles à l'installation</a>
		<a class='metSquare homeCoulour2' href="{% url 'scm:delivery_create' %}">Référencer une livraison</a>
		<a class='metSquare homeCoulour2' href="{% url 'scm:tag_list' %}">Tags</a>
		<a class='metSquare homeCoulour2' href="{% url 'scm:backup_list' %}">Sauvegardes disponibles</a>
		<a class='metSquare homeCoulour2' href="{% url 'scm:lc_list' %}">Versions disponibles</a>
		<div>
		{% for envt in envts %}
			{% if envt.managed %}
				<a class='metSquare' href="{% url 'scm:envtinstallhist' envt.name %}">Historique {{envt.name}}<div class='metSquareLong annotation'>{{latest_setname|get_item:envt.name}}<br/>{{latest_date|get_item:envt.name|date:"d/m H:i"}}</div></a>
			{% endif %}	
		{%endfor %}
		</div>
	</div>
</div>
<div class='col-sm-2'>
	<div style='color: white;' class='row'>
		<div class='t2' style='color: black;'>{{team_links_title}}</div>
	</div>
	<div style='color: white;' class='row'>	
	{% for link in team_links %}
		<a class='metSquare homeCoulour1' href="{{ link.url }}">{{ link.legend|safe }}</a>
	{% endfor %}
	</div>
</div>
<div class='col-sm-2'>
	<div style='color: white;' class='row'>
		<div class='t2' style='color: black;'>Aides scripting</div>
	</div>
	<div style='color: white;' class='row'>	
		<a class='metSquare homeCoulour2' href="{% url 'ref:types' %}">Types de composants installés</a>
		<a class='metSquare homeCoulour2' href="{% url 'ref:mqltester' %}">Requêteur MQL</a>
		<a class='metSquare homeCoulour2' href="{% url 'ref:types_details' %}">Détail des composants installés</a>
		<a class='metSquare homeCoulour2' href="{% url 'ref:urls' %}">API web partielle pour scripts</a>
		<a class='metSquare homeCoulour2' href="{% url 'ref:cartostructure' %}">Graphe des types de composants</a>
	</div>
	<div class='row'>
	{% for envt in templates %}
		<a class='metSquare' href="{% url 'ref:envt' envt.id %}">Template {{envt.name}}<div class='metSquareLong annotation'>{{envt.description}}</div></a>	
	{%endfor %}
	</div>
</div>
</div>
{% endblock content %}
{% endcache %}

